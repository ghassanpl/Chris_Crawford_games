UNIT Edit;INTERFACEUSES{$L-}{$U-}     {$LOAD MQOTP.dumpfile}       Memtypes, QuickDraw, OSIntf, ToolIntf, PackIntf,	 {$LOAD Globals.dumpfile}     {$U Globals.p}  Globals;	 {$LOAD}{$U+}{$SETC DebugFlg:=FALSE}PROCEDURE EditWords;IMPLEMENTATION{$S EditWrds}{********************************************************************************}FUNCTION YourOpen(Filename: Str255): Integer;VAR  Error: OSErr;  LocalNum: Integer;  NameStr:  Str255;  volName:	StringPtr;  WDRefNum:	Integer;  volNamePtr:	StringPtr;BEGIN  Error:=GetVol(NIL,WDRefNum);  Error:=FSOpen(FileName,0,LocalNum);  IF Error<>0 THEN	BEGIN	  ClearRect(100,100,512,120);	  TextFont(0); TextSize(12);	  MoveTo(102,116); DrawString('Disk Problem');	  MyWrite(Error); DrawString(NameStr);	  REPEAT UNTIL Button;	  ExitToShell;	END;  YourOpen:=LocalNum;END;{*******************************************************************************}PROCEDURE EditWords;VAR  Row,Column:  Integer;  i,x,y:       Integer;  HitIcon:     Integer;  Hit2Icon:    Integer;  TempRect:    Rect;  OKFlag:      Boolean;  OutFlag:     Boolean;  LongX:       LongInt;  LoclRect:    Rect;  LoclBits:    ARRAY[1..10304] OF Integer;  LoclBMap:    BitMap;  SelctVal:    Integer;  MyError:	   OSErr;{-------------------------------------------------------------------------------}PROCEDURE NewPage;VAR  Row,Column:  Integer;  i:	   Integer;  TempRect:    Rect;BEGIN  ClearRect(0,20,512,276);  FOR Column:=0 TO 15 DO    BEGIN      FOR Row:=0 TO 7 DO        BEGIN          SetRect(TempRect,32*Column,20+32*Row,32+32*Column,52+32*Row);          CopyBits(WordIcon[8*Column+Row+1],ScreenBits,StdRect1,TempRect,srcCopy,NIL);        END;    END;END;{-------------------------------------------------------------------------------}PROCEDURE CussWord;VAR  i:	  Integer;  SelctFlg:    Boolean;BEGIN  FOR i:=1 TO NumWords DO IF i<>HitIcon THEN    BEGIN      CASE SelctVal OF        1: SelctFlg:=Follows1[i,HitIcon];        2: SelctFlg:=Follows2[i,HitIcon];        3: SelctFlg:=Follows1[HitIcon,i];        4: SelctFlg:=Follows2[HitIcon,i];      END;      IF SelctFlg THEN        BEGIN          x:=(i-1) div 8;          y:=(i-1) mod 8;          SetRect(TempRect,32*x,20+32*y,32+32*x,52+32*y);          InvertRect(TempRect);        END;    END;END;{-------------------------------------------------------------------------------}PROCEDURE Sub1;VAR  i:	       Integer;  TempFlag:    Boolean;BEGIN  MousePt:=myEvent.where;  Column:=MousePt.h div 32;  Row:=(MousePt.v-21) div 32;  IF (Row>=0) AND (Row<8)    THEN Hit2Icon:=8*Column+Row+1    ELSE Hit2Icon:=-1;  IF (Row=8) AND (Column=1) THEN    BEGIN      SetRect(TempRect,33,277,65,309);      FillRect(TempRect,white);      FrameRect(TempRect);      CussWord;      SelctVal:=SelctVal+1; IF SelctVal>4 THEN SelctVal:=1;      IF (HitIcon=0) AND (SelctVal>2) THEN SelctVal:=1;      MoveTo(34,300);      CASE SelctVal OF        1: DrawString('Obj1');        2: DrawString('Obj2');        3: DrawString('Pre1');        4: DrawString('Pre2');      END;      CussWord;    END;  IF (Row=8) AND (Column=3) THEN OKFlag:=TRUE;  SetRect(TempRect,32*Column,20+32*Row,32+32*Column,52+32*Row);  InvertRect(TempRect);  ClearRect(100,320,150,340); MoveTo(100,340); MyWrite(Hit2Icon);  IF Hit2Icon>-1 THEN    BEGIN      IF BitAnd(myEvent.modifiers,ShiftKey)>0 THEN        BEGIN {copy Hit2Icon into HitIcon}          FOR i:=1 TO NumWords DO            BEGIN              TempFlag:=Follows1[i,Hit2Icon];              Follows1[i,HitIcon]:=TempFlag;              TempFlag:=Follows2[i,Hit2Icon];              Follows2[i,HitIcon]:=TempFlag;            END;          FOR i:=0 TO NumWords DO            BEGIN              TempFlag:=Follows1[Hit2Icon,i];              Follows1[HitIcon,i]:=TempFlag;              TempFlag:=Follows2[Hit2Icon,i];              Follows2[HitIcon,i]:=TempFlag;            END;          Hit2Icon:=-1; {hack your way outta here}        END      ELSE        CASE SelctVal OF          1: BEGIN               TempFlag:=Follows1[Hit2Icon,HitIcon];               Follows1[Hit2Icon,HitIcon]:=NOT TempFlag;             END;          2: BEGIN               TempFlag:=Follows2[Hit2Icon,HitIcon];               Follows2[Hit2Icon,HitIcon]:=NOT TempFlag;             END;          3: BEGIN               TempFlag:=Follows1[HitIcon,Hit2Icon];               Follows1[HitIcon,Hit2Icon]:=NOT TempFlag;             END;          4: BEGIN               TempFlag:=Follows2[HitIcon,Hit2Icon];               Follows2[HitIcon,Hit2Icon]:=NOT TempFlag;             END;        END;    END;  IF Hit2Icon=-1 THEN    BEGIN      REPEAT UNTIL NOT StillDown;      InvertRect(TempRect);    END;END;{-------------------------------------------------------------------------------}BEGIN  SetRect(LoclRect,0,20,512,342);  LoclBMap.rowBytes:=64;  LoclBMap.baseAddr:=@LoclBits;  LoclBMap.bounds:=LoclRect;  CopyBits(ScreenBits,LoclBMap,LoclRect,LoclRect,srcCopy,NIL);  ClearRect(0,20,512,342);  NewPage;  SetRect(TempRect,1,277,33,309);  FrameRect(TempRect);  MoveTo(2,300); DrawString('Zero');  SetRect(TempRect,33,277,65,309);  FrameRect(TempRect);  MoveTo(34,300); DrawString('Obj1');  InvertRect(TempRect);  SetRect(TempRect,97,277,129,309);  FrameRect(TempRect);  MoveTo(104,300); DrawString('OK');  OutFlag:=FALSE;  REPEAT    SystemTask;    IF GetNextEvent(everyEvent,myEvent) THEN      BEGIN        IF myEvent.what=mouseDown THEN          BEGIN            SelctVal:=1;            SetRect(TempRect,33,277,65,309);            FillRect(TempRect,white);            FrameRect(TempRect);            MoveTo(34,300); DrawString('Obj1');            MousePt:=myEvent.where;            Column:=MousePt.h div 32;            Row:=(MousePt.v-21) div 32;            IF (Row>=0) AND (Row<8)              THEN HitIcon:=8*Column+Row+1              ELSE HitIcon:=-1;            IF (Row=8) AND (Column=0) THEN HitIcon:=0;            SetRect(TempRect,32*Column,20+32*Row,32+32*Column,52+32*Row);            IF (Row=8) AND (Column=3) THEN OutFlag:=TRUE;            IF HitIcon>-1 THEN              BEGIN {present choices}                ClearRect(1,320,50,340); MoveTo(10,340); MyWrite(HitIcon);                IF HitIcon>0 THEN                  CopyBits(WordText[HitIcon],Screenbits,StdRect1,TempRect,SrcCopy,NIL);                CussWord;                OKFlag:=FALSE;                REPEAT                  SystemTask;                  IF GetNextEvent(everyEvent,myEvent) THEN                    IF myEvent.what=mouseDown THEN Sub1;                UNTIL OKFlag;                ClearRect(150,280,300,304);                IF HitIcon>0 THEN                  BEGIN                    Column:=(HitIcon-1) div 8;                    Row:=(HitIcon-1) mod 8;                    SetRect(TempRect,32*Column,20+32*Row,32+32*Column,52+32*Row);                    CopyBits(WordIcon[8*Column+Row+1],ScreenBits,StdRect1,TempRect,srcCopy,NIL);                  END;                IF HitIcon=0 THEN                  BEGIN                    SetRect(TempRect,1,277,33,309);                    FillRect(TempRect,white);                    FrameRect(TempRect);                    MoveTo(2,300); DrawString('Zero');                  END;                CussWord;              END;          END;      END;    UNTIL OutFlag;  {$IFC DebugFlg}    {IF MyError<>0 THEN MyError:=Create('DataFrame:Siboot:Connections',0,'SIBT','SIBC'); }  {$ENDC}  DummyF1:=YourOpen('Connections');  LongX:=LongInt(@DummyF1)-LongInt(@DummyF2);  x:=FSWrite(DummyF1,LongX,@DummyF2);  x:=FSClose(DummyF1);  x:=FlushVol(NIL,0);  CopyBits(LoclBMap,ScreenBits,LoclRect,LoclRect,srcCopy,NIL);END;{*******************************************************************************}END.